{% extends "base.html" %}

{% block title %}Team {{ team.number }} - {{ team.name }}{% endblock %}

{% block extra_css %}
<style>
    .team-header {
        background: linear-gradient(135deg, var(--cyber-dark) 0%, var(--cyber-gray) 100%);
        border: 2px solid var(--cyber-blue);
        border-radius: 0.5rem;
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: 0 0 30px rgba(0, 217, 255, 0.2);
    }

    .team-number {
        font-family: 'Orbitron', monospace;
        font-size: 3.5rem;
        font-weight: 900;
        color: var(--cyber-blue);
        text-shadow: 0 0 20px var(--cyber-blue);
        margin-bottom: 0.5rem;
    }

    .team-name {
        font-size: 1.5rem;
        font-weight: 600;
        margin-bottom: 1rem;
    }

    .team-meta {
        display: flex;
        gap: 1.5rem;
        flex-wrap: wrap;
        color: #9ca3af;
        font-size: 0.875rem;
    }

    .question-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
    }

    .question-item {
        background: var(--cyber-gray);
        border: 1px solid var(--cyber-border);
        border-radius: 0.375rem;
        padding: 1rem;
        transition: all 0.2s;
    }

    .question-item:hover {
        border-color: var(--cyber-blue);
    }

    .question-item input[type="checkbox"] {
        width: 1.25rem;
        height: 1.25rem;
        margin-right: 0.75rem;
        accent-color: var(--cyber-blue);
        cursor: pointer;
    }

    .question-item label {
        display: flex;
        align-items: center;
        cursor: pointer;
        font-size: 0.95rem;
    }

    .section-header {
        font-family: 'Orbitron', monospace;
        font-size: 1.5rem;
        color: var(--cyber-blue);
        margin-bottom: 1rem;
        padding-bottom: 0.5rem;
        border-bottom: 2px solid var(--cyber-border);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .photo-upload {
        border: 2px dashed var(--cyber-border);
        border-radius: 0.5rem;
        padding: 2rem;
        text-align: center;
        cursor: pointer;
        transition: all 0.3s;
    }

    .photo-upload:hover {
        border-color: var(--cyber-blue);
        background: rgba(0, 217, 255, 0.05);
    }

    .robot-photo {
        max-width: 100%;
        max-height: 400px;
        border-radius: 0.5rem;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.4);
    }

    canvas {
        border: 2px solid var(--cyber-border);
        border-radius: 0.5rem;
        cursor: crosshair;
        background: var(--cyber-darker);
        width: 100%;
        max-width: 800px;
    }

    .drawing-tools {
        display: flex;
        gap: 0.5rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
    }

    .color-btn {
        width: 40px;
        height: 40px;
        border: 2px solid var(--cyber-border);
        border-radius: 0.375rem;
        cursor: pointer;
        transition: all 0.2s;
    }

    .color-btn:hover, .color-btn.active {
        border-color: var(--cyber-blue);
        transform: scale(1.1);
    }

    textarea.cyber-input {
        min-height: 200px;
        font-family: 'JetBrains Mono', monospace;
        resize: vertical;
    }

    .category-title {
        font-family: 'Orbitron', monospace;
        color: var(--cyber-purple);
        font-size: 1.1rem;
        margin: 1.5rem 0 0.75rem 0;
        font-weight: 600;
    }
</style>
{% endblock %}

{% block content %}
<a href="/directory" class="cyber-button-secondary" style="margin-bottom: 1.5rem; display: inline-block;">‚Üê Back to Directory</a>

<!-- Team Header -->
<div class="team-header animate-slide-up">
    <div class="team-number">#{{ team.number }}</div>
    <div class="team-name">{{ team.name or 'Team ' + team.number }}</div>
    <div class="team-meta">
        {% if team.opr %}
        <span><strong>OPR:</strong> <span style="color: var(--cyber-purple); font-weight: 600;">{{ "%.2f"|format(team.opr) }}</span></span>
        {% endif %}
        {% if team.city %}
        <span><strong>üìç</strong> {{ team.city }}{% if team.state %}, {{ team.state }}{% endif %}</span>
        {% endif %}
        {% if team.rookie_year %}
        <span><strong>Rookie Year:</strong> {{ team.rookie_year }}</span>
        {% endif %}
    </div>
</div>

<div class="grid grid-2">
    <!-- Left Column: Interview & Photo -->
    <div>
        <!-- DECODE 2025-2026 Interview Questions -->
        <div class="cyber-card animate-slide-up" style="animation-delay: 0.1s;">
            <h2 class="section-header">üìã DECODE Scouting Checklist</h2>
            
            <form method="POST" action="/save_interview">
                <input type="hidden" name="team_num" value="{{ team.number }}">
                
                <div class="question-grid">
                    <h3 class="category-title" style="grid-column: 1 / -1;">ü§ñ Autonomous Period</h3>
                    
                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q1" value="Yes" {% if interview and 'Reliable auto routine' in interview.answers|from_json and interview.answers|from_json['Reliable auto routine'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q1_text" value="Reliable auto routine">
                            Reliable auto routine
                        </label>
                    </div>
                    
                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q2" value="Yes" {% if interview and 'Scores artifacts in auto' in interview.answers|from_json and interview.answers|from_json['Scores artifacts in auto'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q2_text" value="Scores artifacts in auto">
                            Scores artifacts in auto
                        </label>
                    </div>
                    
                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q3" value="Yes" {% if interview and 'Clears classifier in auto' in interview.answers|from_json and interview.answers|from_json['Clears classifier in auto'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q3_text" value="Clears classifier in auto">
                            Clears classifier in auto
                        </label>
                    </div>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q4" value="Yes" {% if interview and 'MOTIF pattern detection' in interview.answers|from_json and interview.answers|from_json['MOTIF pattern detection'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q4_text" value="MOTIF pattern detection">
                            MOTIF pattern detection
                        </label>
                    </div>

                    <h3 class="category-title" style="grid-column: 1 / -1;">üéØ TeleOp Scoring</h3>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q5" value="Yes" {% if interview and 'Fast artifact cycles (<8s)' in interview.answers|from_json and interview.answers|from_json['Fast artifact cycles (<8s)'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q5_text" value="Fast artifact cycles (<8s)">
                            Fast artifact cycles (<8s)
                        </label>
                    </div>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q6" value="Yes" {% if interview and 'Accurate goal scoring' in interview.answers|from_json and interview.answers|from_json['Accurate goal scoring'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q6_text" value="Accurate goal scoring">
                            Accurate goal scoring
                        </label>
                    </div>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q7" value="Yes" {% if interview and 'Can form MOTIF patterns' in interview.answers|from_json and interview.answers|from_json['Can form MOTIF patterns'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q7_text" value="Can form MOTIF patterns">
                            Can form MOTIF patterns
                        </label>
                    </div>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q8" value="Yes" {% if interview and 'Consistent launcher/shooter' in interview.answers|from_json and interview.answers|from_json['Consistent launcher/shooter'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q8_text" value="Consistent launcher/shooter">
                            Consistent launcher/shooter
                        </label>
                    </div>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q9" value="Yes" {% if interview and 'Effective gate operation' in interview.answers|from_json and interview.answers|from_json['Effective gate operation'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q9_text" value="Effective gate operation">
                            Effective gate operation
                        </label>
                    </div>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q10" value="Yes" {% if interview and 'Handles classifier well' in interview.answers|from_json and interview.answers|from_json['Handles classifier well'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q10_text" value="Handles classifier well">
                            Handles classifier well
                        </label>
                    </div>

                    <h3 class="category-title" style="grid-column: 1 / -1;">‚è±Ô∏è Endgame</h3>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q11" value="Yes" {% if interview and 'Consistent BASE zone parking' in interview.answers|from_json and interview.answers|from_json['Consistent BASE zone parking'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q11_text" value="Consistent BASE zone parking">
                            Consistent BASE zone parking
                        </label>
                    </div>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q12" value="Yes" {% if interview and 'Quick endgame transition' in interview.answers|from_json and interview.answers|from_json['Quick endgame transition'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q12_text" value="Quick endgame transition">
                            Quick endgame transition
                        </label>
                    </div>

                    <h3 class="category-title" style="grid-column: 1 / -1;">‚öôÔ∏è Robot Capabilities</h3>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q13" value="Yes" {% if interview and 'Skilled driver(s)' in interview.answers|from_json and interview.answers|from_json['Skilled driver(s)'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q13_text" value="Skilled driver(s)">
                            Skilled driver(s)
                        </label>
                    </div>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q14" value="Yes" {% if interview and 'Fast/agile drivetrain' in interview.answers|from_json and interview.answers|from_json['Fast/agile drivetrain'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q14_text" value="Fast/agile drivetrain">
                            Fast/agile drivetrain
                        </label>
                    </div>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q15" value="Yes" {% if interview and 'Reliable intake mechanism' in interview.answers|from_json and interview.answers|from_json['Reliable intake mechanism'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q15_text" value="Reliable intake mechanism">
                            Reliable intake mechanism
                        </label>
                    </div>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q16" value="Yes" {% if interview and 'Minimal breakdowns' in interview.answers|from_json and interview.answers|from_json['Minimal breakdowns'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q16_text" value="Minimal breakdowns">
                            Minimal breakdowns
                        </label>
                    </div>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q17" value="Yes" {% if interview and 'Can control 3+ artifacts' in interview.answers|from_json and interview.answers|from_json['Can control 3+ artifacts'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q17_text" value="Can control 3+ artifacts">
                            Can control 3+ artifacts
                        </label>
                    </div>

                    <h3 class="category-title" style="grid-column: 1 / -1;">ü§ù Team Quality</h3>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q18" value="Yes" {% if interview and 'Good communication' in interview.answers|from_json and interview.answers|from_json['Good communication'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q18_text" value="Good communication">
                            Good communication
                        </label>
                    </div>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q19" value="Yes" {% if interview and 'Adapts strategy mid-match' in interview.answers|from_json and interview.answers|from_json['Adapts strategy mid-match'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q19_text" value="Adapts strategy mid-match">
                            Adapts strategy mid-match
                        </label>
                    </div>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q20" value="Yes" {% if interview and 'Quick pit repairs' in interview.answers|from_json and interview.answers|from_json['Quick pit repairs'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q20_text" value="Quick pit repairs">
                            Quick pit repairs
                        </label>
                    </div>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q21" value="Yes" {% if interview and 'Gracious professionalism' in interview.answers|from_json and interview.answers|from_json['Gracious professionalism'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q21_text" value="Gracious professionalism">
                            Gracious professionalism
                        </label>
                    </div>

                    <h3 class="category-title" style="grid-column: 1 / -1;">üèÜ Alliance Selection</h3>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q22" value="Yes" {% if interview and 'Captain material' in interview.answers|from_json and interview.answers|from_json['Captain material'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q22_text" value="Captain material">
                            Captain material
                        </label>
                    </div>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q23" value="Yes" {% if interview and 'Top alliance pick' in interview.answers|from_json and interview.answers|from_json['Top alliance pick'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q23_text" value="Top alliance pick">
                            Top alliance pick
                        </label>
                    </div>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q24" value="Yes" {% if interview and 'Complements our strategy' in interview.answers|from_json and interview.answers|from_json['Complements our strategy'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q24_text" value="Complements our strategy">
                            Complements our strategy
                        </label>
                    </div>

                    <div class="question-item">
                        <label>
                            <input type="checkbox" name="q25" value="Yes" {% if interview and 'Would pick again' in interview.answers|from_json and interview.answers|from_json['Would pick again'] == 'Yes' %}checked{% endif %}>
                            <input type="hidden" name="q25_text" value="Would pick again">
                            Would pick again
                        </label>
                    </div>
                </div>

                <label style="display: block; margin-bottom: 0.5rem; font-weight: 600;">Additional Notes:</label>
                <textarea name="notes" class="cyber-input" placeholder="Detailed observations, strategies, strengths, weaknesses...">{{ interview.notes if interview else '' }}</textarea>

                <button type="submit" class="cyber-button" style="margin-top: 1rem; width: 100%;">üíæ Save Interview</button>
            </form>
        </div>

        <!-- Robot Photo Upload -->
        <div class="cyber-card" style="margin-top: 1.5rem;">
            <h2 class="section-header">üì∏ Robot Photo</h2>
            {% if team.photo_path %}
                <img src="{{ url_for('static', filename='uploads/' + team.photo_path) }}" class="robot-photo" alt="Robot Photo">
            {% else %}
                <form method="POST" action="/upload_photo" enctype="multipart/form-data">
                    <input type="hidden" name="team_num" value="{{ team.number }}">
                    <div class="photo-upload">
                        <input type="file" name="photo" accept="image/*" class="cyber-input" required>
                        <p style="margin-top: 1rem; color: #9ca3af;">Upload a photo of the robot</p>
                    </div>
                    <button type="submit" class="cyber-button" style="margin-top: 1rem; width: 100%;">Upload Photo</button>
                </form>
            {% endif %}
        </div>
    </div>

    <!-- Right Column: Drawing Canvas -->
    <div>
        <div class="cyber-card animate-slide-up" style="animation-delay: 0.2s;">
            <h2 class="section-header">üé® Strategy Canvas</h2>
            
            <div class="drawing-tools">
                <button class="color-btn active" style="background: #ef4444;" data-color="#ef4444" title="Red Alliance"></button>
                <button class="color-btn" style="background: #3b82f6;" data-color="#3b82f6" title="Blue Alliance"></button>
                <button class="color-btn" style="background: #eab308;" data-color="#eab308" title="Yellow"></button>
                <button class="color-btn" style="background: #22c55e;" data-color="#22c55e" title="Green"></button>
                <button class="color-btn" style="background: #a855f7;" data-color="#a855f7" title="Purple"></button>
                <button class="color-btn" style="background: #ffffff;" data-color="#ffffff" title="White"></button>
                
                <button class="cyber-button-secondary" onclick="clearCanvas()">üóëÔ∏è Clear</button>
                <button class="cyber-button" onclick="saveDrawing()">üíæ Save Drawing</button>
            </div>

            <canvas id="drawingCanvas" width="800" height="600"></canvas>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('drawingCanvas');
    const ctx = canvas.getContext('2d');
    let isDrawing = false;
    let currentColor = '#ef4444';
    let lastX = 0;
    let lastY = 0;

    // Load existing drawing
    {% if drawing %}
        const img = new Image();
        img.onload = () => ctx.drawImage(img, 0, 0);
        img.src = '{{ drawing.image_data }}';
    {% else %}
        // Draw grid
        ctx.strokeStyle = '#2a3547';
        ctx.lineWidth = 1;
        for (let i = 0; i < canvas.width; i += 50) {
            ctx.beginPath();
            ctx.moveTo(i, 0);
            ctx.lineTo(i, canvas.height);
            ctx.stroke();
        }
        for (let i = 0; i < canvas.height; i += 50) {
            ctx.beginPath();
            ctx.moveTo(0, i);
            ctx.lineTo(canvas.width, i);
            ctx.stroke();
        }
    {% endif %}

    // Color selection
    document.querySelectorAll('.color-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            document.querySelectorAll('.color-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            currentColor = this.dataset.color;
        });
    });

    // Drawing functions
    canvas.addEventListener('mousedown', (e) => {
        isDrawing = true;
        [lastX, lastY] = [e.offsetX, e.offsetY];
    });

    canvas.addEventListener('mousemove', (e) => {
        if (!isDrawing) return;
        ctx.strokeStyle = currentColor;
        ctx.lineWidth = 3;
        ctx.lineCap = 'round';
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(e.offsetX, e.offsetY);
        ctx.stroke();
        [lastX, lastY] = [e.offsetX, e.offsetY];
    });

    canvas.addEventListener('mouseup', () => isDrawing = false);
    canvas.addEventListener('mouseout', () => isDrawing = false);

    // Touch support
    canvas.addEventListener('touchstart', (e) => {
        e.preventDefault();
        const touch = e.touches[0];
        const rect = canvas.getBoundingClientRect();
        lastX = touch.clientX - rect.left;
        lastY = touch.clientY - rect.top;
        isDrawing = true;
    });

    canvas.addEventListener('touchmove', (e) => {
        if (!isDrawing) return;
        e.preventDefault();
        const touch = e.touches[0];
        const rect = canvas.getBoundingClientRect();
        const x = touch.clientX - rect.left;
        const y = touch.clientY - rect.top;
        
        ctx.strokeStyle = currentColor;
        ctx.lineWidth = 3;
        ctx.lineCap = 'round';
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(x, y);
        ctx.stroke();
        [lastX, lastY] = [x, y];
    });

    canvas.addEventListener('touchend', () => isDrawing = false);

    function clearCanvas() {
        if (confirm('Clear the canvas?')) {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = '#0a0e17';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
    }

    function saveDrawing() {
        const dataURL = canvas.toDataURL();
        fetch('/save_drawing', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({team_num: '{{ team.number }}', image: dataURL})
        }).then(() => alert('‚úÖ Drawing saved!'));
    }
</script>
{% endblock %}
